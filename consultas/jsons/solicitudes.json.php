<?php $ROOT = (!isset($ROOT)) ? "../../../../" : $ROOT;require_once($ROOT . "modulos/alcantarillado/librerias/Configuracion.cnf.php");//\\//\\//\\//\\ Inicializando Variables //\\//\\//\\//\\$fechas =new Fechas();//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\$page = 1;$perpage = 50;$n = 0;$pagination = false;if (isset($_REQUEST["page"])) { $pagination = true; $page = intval($_REQUEST["page"]); $perpage = intval($_REQUEST["perpage"]); $n = ( $page - 1 ) * $perpage;}if (isset($_REQUEST["buscar"])) { $buscar = $_REQUEST["buscar"]; $buscar = "WHERE(`servicio`='02' AND (`solicitud` LIKE '%" . $buscar . "%' OR `dane` LIKE '%" . $buscar . "%' OR `servicio` LIKE '%" . $buscar . "%' OR `radicado` LIKE '%" . $buscar . "%' OR `radicacion` LIKE '%" . $buscar . "%' OR `categoria` LIKE '%" . $buscar . "%' OR `causal` LIKE '%" . $buscar . "%' OR `asunto` LIKE '%" . $buscar . "%' OR `detalle` LIKE '%" . $buscar . "%' OR `suscriptor` LIKE '%" . $buscar . "%' OR `factura` LIKE '%" . $buscar . "%' OR `respuesta` LIKE '%" . $buscar . "%' OR `contestacion` LIKE '%" . $buscar . "%' OR `radicada` LIKE '%" . $buscar . "%' OR `notificado` LIKE '%" . $buscar . "%' OR `notificacion` LIKE '%" . $buscar . "%' OR `sspd` LIKE '%" . $buscar . "%' OR `ejecucion` LIKE '%" . $buscar . "%' OR `orden` LIKE '%" . $buscar . "%' OR `fecha` LIKE '%" . $buscar . "%' OR `nombres` LIKE '%" . $buscar . "%' OR `apellidos` LIKE '%" . $buscar . "%' OR `documentos` LIKE '%" . $buscar . "%' OR `identificacion` LIKE '%" . $buscar . "%' OR `nacimiento` LIKE '%" . $buscar . "%' OR `sexo` LIKE '%" . $buscar . "%' OR `telefono` LIKE '%" . $buscar . "%' OR `movil` LIKE '%" . $buscar . "%' OR `correo` LIKE '%" . $buscar . "%' OR `pais` LIKE '%" . $buscar . "%' OR `region` LIKE '%" . $buscar . "%' OR `ciudad` LIKE '%" . $buscar . "%' OR `sector` LIKE '%" . $buscar . "%' OR `direccion` LIKE '%" . $buscar . "%' OR `referencia` LIKE '%" . $buscar . "%' OR `expiracion` LIKE '%" . $buscar . "%' OR `instalacion` LIKE '%" . $buscar . "%' OR `estrato` LIKE '%" . $buscar . "%' OR `diametro` LIKE '%" . $buscar . "%' OR `creador` LIKE '%" . $buscar . "%' OR `legalizado` LIKE '%" . $buscar . "%' OR `matricula` LIKE '%" . $buscar . "%'))"; //$buscar = "";} else { $buscar = "WHERE (`servicio`='02')";}// this variables Omnigrid will send only if serverSort option is true//$sorton = @$_REQUEST["sorton"];//$sortby = @$_REQUEST["sortby"];$db =new MySQL(Sesion::getConexion());$sql['sql'] = "SELECT * FROM `solicitudes_solicitudes` " . $buscar . " ;";//echo($sql['sql']);$result = $db->sql_query($sql['sql']);$fila = $db->sql_fetchrow($result);$total = $db->sql_numrows();$limit = "";if ($pagination) { $limit = "LIMIT $n, $perpage";}$result = $db->sql_query("SELECT * FROM `solicitudes_solicitudes` " . $buscar . " ORDER BY `radicacion` DESC,`solicitud` DESC " . $limit);$ret = array();while ($fila = $db->sql_fetchrow($result)) { $nombre = $cadenas->capitalizar($fila['nombres'] . " " . $fila['apellidos']); $direccion = (!empty($fila['instalacion'])) ? $fila['instalacion'] : $fila['direccion']; $detalles = $cadenas->capitalizar($direccion) . " <i>Tels: " . $fila['telefono'] . " " . $fila['movil'] . "</i>"; $servicio = $servicios->consultar($fila['servicio']); $servicio = "<a href=\"#\" title=\"Estado\" onclick=\"parent.MUI.Notificacion('" . $servicio['nombre'] . "');\"><img src=\"../../../imagenes/16x16/" . ($servicio['icono']) . "\" width=\"16\" height=\"16\"/>"; $asunto = $asuntos->consultar($fila['asunto']); $creador = $usuarios->consultar($fila['creador']); // Elementos opciones de la fila $elemento['eliminar'] = "&nbsp;<a href=\"#\" onClick=\"parent.MUI.Distribucion_Solicitud_Eliminar('" . $fila['solicitud'] . "');\"><img src=\"../../../imagenes/16x16/eliminar.png\"></a>"; $elemento['creador'] = "&nbsp;<a href=\"#\" onClick=\"parent.MUI.Notificacion('" . $creador['alias'] . "');\"><img src=\"../../../imagenes/16x16/usuario-16x16.png\"></a>"; // Calculos y adecuaciones de los valoresa retornar. $fila['detalles'] = "<span><b>" . $nombre . "</b> <i>" . $detalles . "</i><span>"; $fila['servicio'] = $servicio; if ($fila['legalizado'] == "NO") {  $fila['estado'] = "rojo";  $fila['opciones'] = "<a href=\"#\" title=\"Estado\" onclick=\"parent.MUI.Suscriptores_Solicitud_Eliminar('" . @$fila['solicitud'] . "');\"><img src=\"../../../imagenes/16x16/eliminar.png\" width=\"16\" height=\"16\"/>"; } elseif ($fila['legalizado'] == "SI") {  $fila['estado'] = "verde";  $fila['opciones'] = "<a href=\"#\"><img src=\"../../../imagenes/16x16/_eliminar.png\" width=\"16\" height=\"16\"/></a>"; } else {  $fila['estado'] = "amarillo"; } $fila['tiempo'] = "&nbsp;<span>" . $fechas->trascurrido($fila['radicacion'], $fechas->hoy(), "expresion") . "<span>"; $fila['radicacion'] = "<span>" . $fila['radicacion'] . "</span>"; $fila['estado'] = "<a href=\"#\" title=\"Estado\" onclick=\"parent.MUI.Notificacion('" . @$fila['radicada'] . "');\"><img src=\"../../../imagenes/16x16/" . ($fila['estado']) . "-16x16.png\" width=\"16\" height=\"16\"/>"; $fila['solicitud'] = "&nbsp;<a href=\"#\" title=\"Estado\" onclick=\"parent.MUI.Distribucion_Solicitud_Consultar('" . @$fila['solicitud'] . "');\">" . $fila['solicitud'] . "</a>&nbsp;"; if (!empty($fila['matricula'])) {  $fila['suscriptor'] = "&nbsp;" . $fila['matricula']; } else {  $fila['suscriptor'] = "&nbsp;" . $fila['suscriptor']; } // Opcion que permite eliminar el PQR $fila['eliminar'] = (($sesion->getValue("DISTRIBUCION-PQRS-ELIMINAR") && $sesion->getValue("usuario") == $creador['usuario']) || $sesion->getValue("DISTRIBUCION-PQRS-ELIMINAR-TODO")) ? $elemento['eliminar'] : ""; $fila['creador'] = $elemento['creador']; array_push($ret, $fila);}$db->sql_close();$ret = array("page" => $page, "total" => $total, "data" => $ret);echo json_encode($ret);?>