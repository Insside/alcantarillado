<?php /** * Nota: A futuro y para evitar confusiones el cambio recursivo en los nombres de los campos del formulario * se debe a la necesidad de hacerlos unicos y controlar los eventos entre multiples ventanas abiertas * realziando diferentes procesos de este modo las ventanas y sus accioens coexisten individualmente. * */$ROOT = (!isset($ROOT)) ? "../../../" : $ROOT;require_once($ROOT . "modulos/alcantarillado/librerias/Configuracion.cnf.php");$solicitudes =new Solicitudes();$solicitud = $solicitudes->consultar(@$_REQUEST['solicitud']);$servicio = $servicios->consultar($solicitud['servicio']);$categoria = $categorias->consultar($solicitud['categoria']);$causal = $causales->consultar($solicitud['servicio'], $solicitud['causal']);$asunto = $asuntos->consultar($solicitud['asunto']);$sesion =new Sesion();$transaccion = @$_REQUEST['transaccion'];$accion = @$_REQUEST['accion'];// Si se recibe la accion actualizar-solicitanteif ($accion == "actualizar-solicitante") { // Almacenar en la base de datos $pqrs =new PQRS(); $valor['suscriptor'] = @$_REQUEST['suscriptor']; $valor['solicitud'] = @$_REQUEST['solicitud']; $valor['servicio'] = @$_REQUEST['servicio' . $transaccion]; $valor['radicacion'] = @$_REQUEST['radicacion']; $valor['categoria'] = @$_REQUEST['categoria' . $transaccion]; $valor['causal'] = @$_REQUEST['causal' . $transaccion]; $valor['asunto'] = @$_REQUEST['asunto']; $valor['detalle'] = urlencode(@$_REQUEST['detalle']); $valor['creador'] = intval($sesion->getValue('usuario')); $valor['nombres'] = $cadenas->capitalizar(@$_REQUEST['nombres']); $valor['apellidos'] = $cadenas->capitalizar(@$_REQUEST['apellidos']); $valor['documentos'] = @$_REQUEST['documentos']; $valor['identificacion'] = @$_REQUEST['identificacion']; $valor['nacimiento'] = @$_REQUEST['nacimiento']; $valor['sexo'] = @$_REQUEST['sexo']; $valor['telefono'] = @$_REQUEST['telefono']; $valor['movil'] = @$_REQUEST['movil']; $valor['correo'] = @$_REQUEST['correo']; $valor['pais'] = @$_REQUEST['pais']; $valor['region'] = @$_REQUEST['region']; $valor['ciudad'] = @$_REQUEST['ciudad']; $valor['sector'] = @$_REQUEST['sector']; $valor['direccion'] = @$_REQUEST['direccion']; $valor['referencia'] = @$_REQUEST['referencia']; $numero = count($valor); $tags = array_keys($valor); $valores = array_values($valor); for ($i = 0; $i < $numero; $i++) {  $pqrs->actualizar($valor['solicitud'], $tags[$i], $valores[$i]); }} elseif ($accion == "actualizar-solicitud") { echo("Actualizar Solicitud"); $pqrs =new PQRS(); $valor = NULL; $valor['solicitud'] = @$_REQUEST['solicitud']; $valor['asunto'] = @$_REQUEST['asunto']; $valor['detalle'] = @$_REQUEST['detalle']; $numero = count($valor); $tags = array_keys($valor); $valores = array_values($valor); for ($i = 0; $i < $numero; $i++) {  $pqrs->actualizar($valor['solicitud'], $tags[$i], $valores[$i]); }}$formulario =new Forms($transaccion);echo($formulario->apertura());?><?php $vinculo['parametros'] = "?transaccion=" . $transaccion . "&solicitud=" . $solicitud['solicitud'];$vinculo['perfiles'] = 'modulos/alcantarillado/formularios/solicitud/consultar/perfiles.xhr.php' . $vinculo['parametros'];$vinculo['solicitud'] = 'modulos/alcantarillado/formularios/solicitud/consultar/solicitud.xhr.php' . $vinculo['parametros'];?><div class="toolbarTabs<?php  echo($transaccion); ?>"> <ul id="featuresTabs<?php  echo($transaccion); ?>" class="tab-menu">  <li class="selected"><a href="#" title="Perfiles" id="tabPerfiles<?php  echo($transaccion); ?>">Perfiles</a></li>  <li><a href="#" title="Solicitud" id="tabSolicitud<?php  echo($transaccion); ?>">Solicitud</a></li> </ul> <div class="clear"></div></div><input name="accion" id="accion" type="hidden" value="" /><input name="solicitud" id="solicitud" type="hidden" value="<?php  echo($solicitud['solicitud']); ?>" /><input name="transaccion" id="transaccion" type="hidden" value="<?php  echo($transaccion); ?>" /><div id="divPerfiles<?php  echo($transaccion); ?>"><?php  require_once($ROOT . "modulos/alcantarillado/formularios/solicitud/consultar/perfiles.inc.php"); ?></div><div id="divSolicitud<?php  echo($transaccion); ?>"><?php  require_once($ROOT . "modulos/alcantarillado/formularios/solicitud/consultar/solicitud.inc.php"); ?></div><div id="divEditarSolicitante<?php  echo($transaccion); ?>"><?php  require_once($ROOT . "modulos/alcantarillado/formularios/solicitud/consultar/editar.solicitante.inc.php"); ?></div><div id="divEditarSolicitud<?php  echo($transaccion); ?>"><?php  require_once($ROOT . "modulos/alcantarillado/formularios/solicitud/consultar/editar.solicitud.inc.php"); ?></div><?php  echo($formulario->cierre()); ?><?php  if (empty($accion)) { ?> <script type="text/javascript">  MUI.initializeTabs('featuresTabs<?php  echo($transaccion); ?>');  if ($('responder<?php  echo($transaccion); ?>')) {   $('responder<?php  echo($transaccion); ?>').addEvent('click', function(e) {    MUI.Distribucion_Solicitud_Responder('<?php  echo($solicitud['solicitud']); ?>');    MUI.closeWindow($('<?php  echo($formulario->ventana); ?>'));   });  }  if ($('tabPerfiles<?php  echo($transaccion); ?>')) {   $('tabPerfiles<?php  echo($transaccion); ?>').addEvent('click', function(e) {    // alert("Perfiles");    $("divPerfiles<?php  echo($transaccion); ?>").show();    $("divSolicitud<?php  echo($transaccion); ?>").hide();    $("divEditarSolicitante<?php  echo($transaccion); ?>").hide();    $("divEditarSolicitud<?php  echo($transaccion); ?>").hide();    if ($('<?php  echo($formulario->interno ); ?>') && MUI.options.standardEffects == true) {     $('<?php  echo($formulario->interno ); ?>').setStyle('opacity', 0).get('morph').start({'opacity': 1});    }   });  }  if ($('tabSolicitud<?php  echo($transaccion); ?>')) {   $('tabSolicitud<?php  echo($transaccion); ?>').addEvent('click', function(e) {    //alert("Solicitud");    $("divPerfiles<?php  echo($transaccion); ?>").hide();    $("divSolicitud<?php  echo($transaccion); ?>").show();    $("divEditarSolicitante<?php  echo($transaccion); ?>").hide();    $("divEditarSolicitud<?php  echo($transaccion); ?>").hide();    if ($('<?php  echo($formulario->interno ); ?>') && MUI.options.standardEffects == true) {     $('<?php  echo($formulario->interno ); ?>').setStyle('opacity', 0).get('morph').start({'opacity': 1});    }   });  }  if ($('linkEditarSolicitante<?php  echo($transaccion); ?>')) {   $('linkEditarSolicitante<?php  echo($transaccion); ?>').addEvent('click', function(e) {    $("divPerfiles<?php  echo($transaccion); ?>").hide();    $("divSolicitud<?php  echo($transaccion); ?>").hide();    $("divEditarSolicitante<?php  echo($transaccion); ?>").show();    $("divEditarSolicitud<?php  echo($transaccion); ?>").hide();    if ($('<?php  echo($formulario->interno ); ?>') && MUI.options.standardEffects == true) {     $('<?php  echo($formulario->interno ); ?>').setStyle('opacity', 0).get('morph').start({'opacity': 1});    }   });  }  if ($('linkEditarSolicitud<?php  echo($transaccion); ?>')) {   $('linkEditarSolicitud<?php  echo($transaccion); ?>').addEvent('click', function(e) {    $("divPerfiles<?php  echo($transaccion); ?>").hide();    $("divSolicitud<?php  echo($transaccion); ?>").hide();    $("divEditarSolicitante<?php  echo($transaccion); ?>").hide();    $("divEditarSolicitud<?php  echo($transaccion); ?>").show();    if ($('<?php  echo($formulario->interno ); ?>') && MUI.options.standardEffects == true) {     $('<?php  echo($formulario->interno ); ?>').setStyle('opacity', 0).get('morph').start({'opacity': 1});    }   });  }  var fv<?php  echo($transaccion); ?> =new Form.Validator.Inline($('<?php  echo($formulario->id); ?>'));  new Form.Request($('<?php  echo($formulario->id); ?>'), $('<?php  echo($formulario->interno); ?>'), {   requestOptions: {    spinnerOptions: {     message: 'Trasmitiendo datos...'    }   },   onSend: function() {    $('spinner').show();   },   onSuccess: function() {    $('spinner').hide();    if ($('<?php  echo($formulario->interno ); ?>') && MUI.options.standardEffects == true) {     $('<?php  echo($formulario->interno ); ?>').setStyle('opacity', 0).get('morph').start({'opacity': 1});    }    MUI.closeWindow($('<?php  echo($formulario->ventana); ?>'));   }  }); </script><?php  } ?>