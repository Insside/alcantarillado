<?php /** * Este formulario permite filtrar el listado de instalaciones. * Para poder utilizarlo se requiere que el usuario en sus roles asignados disponga del permiso * SUSCRIPTORES-SOLICITUDES-U */$ROOT = (!isset($ROOT)) ? "../../../" : $ROOT;require_once($ROOT . "modulos/alcantarillado/librerias/Configuracion.cnf.php");//\\//\\//\\//\\ Variables Generadas //\\//\\//\\//\\$sesion =new Sesion();$transaccion = @$_REQUEST['transaccion'];$accion = @$_REQUEST['accion'];$formulario =new Forms($transaccion);echo($formulario->apertura());?><input type="hidden" name="accion" id="accion" value="filtrar"/><?php $inicial = @$_REQUEST['fecha_inicial'];$final = @$_REQUEST['fecha_final'];$inicial = (empty($inicial)) ? $fechas->hoy() : $inicial;$final = (empty($final)) ? $fechas->hoy() : $final;$page = 1;$perpage = 10000;$n = 0;$pagination = false;if (isset($_REQUEST["page"])) { $pagination = true; $page = intval($_REQUEST["page"]); $perpage = intval($_REQUEST["perpage"]); $n = ( $page - 1 ) * $perpage;}$buscar = "WHERE( `fecha` BETWEEN '" . $inicial . "' AND '" . $final . "') ";$db =new MySQL(Sesion::getConexion());$sql['sql'] = "SELECT * FROM `distribucion_instalaciones` " . $buscar . " ORDER BY `fecha` ASC;";//echo($sql['sql']);$consulta = $db->sql_query($sql['sql']);$fila = $db->sql_fetchrow($consulta);$total = $db->sql_numrows();$limit = "";if ($pagination) { $limit = "LIMIT $n, $perpage";}$consulta = $db->sql_query("SELECT * FROM `distribucion_instalaciones` " . $buscar . " ORDER BY `suscriptor`,`fecha` ASC " . $limit);$ret = array();?><div id="controles"style=" padding:10px; background-color:#cccccc" align="center"> <table>  <tr>   <td>Inicio:</td>   <td><input tabindex="1" type="text" readonly="readonly" class="input" id="fecha_inicial" name="fecha_inicial" value="<?php  echo($inicial) ?>"/></td>   <td>Finalización:</td>   <td><input tabindex="2" type="text" readonly="readonly" class="input" id="fecha_final" name="fecha_final" value="<?php  echo($final) ?>"/></td>   <td><input type="submit" value="Filtrar" name="filtrar" id="filtrar" /></td>   <td><input type="button" name="imprimir" id="imprimir" class="button" value="Imprimir Planilla" /></td>  </tr> </table></div><div id="contenido_impresion" style=" padding:10px; background-color:#FFF"> <img src="imagenes/logos/membrete.png" style="left:-30px; top:0px;height: 100px;"/> <h2 style="text-align: center; font-size: 20px; ">Listado Ordenes De Instalación</h2> <table width="100%" border="1">  <tr>   <th align="center" style="font-size: 14px;">&nbsp;Instalación&nbsp;</th>   <th align="center" style="font-size: 14px;">&nbsp;Suscriptor&nbsp;</th>   <th align="center" style="font-size: 14px;">&nbsp;Nombre&nbsp;</th>   <th align="center" style="font-size: 14px;">&nbsp;Dirección&nbsp;</th>   <th align="center" style="font-size: 14px;">&nbsp;Teléfono&nbsp;</th>   <th align="center" style="font-size: 14px;">&nbsp;TI&nbsp;</th>   <th align="center" style="font-size: 14px;">&nbsp;D&nbsp;</th>   <th align="center" style="font-size: 14px;" >&nbsp;Fecha&nbsp;</th>   <th align="center" style="font-size: 14px; width: 100px;" >Trabajador</th>  </tr>  <?php   while ($fila = $db->sql_fetchrow($consulta)) {   $creador = $usuarios->consultar($fila['creador']);   $suscriptor = $suscriptores->consultar($fila['suscriptor']);   $solicitud = $instalaciones->solicitud($fila['suscriptor']);   $sector = $solicitud["sector"];   $nombre = "<b>" . $cadenas->capitalizar($suscriptor['nombres'] . " " . $suscriptor['apellidos']) . "</b>";   $direccion = $cadenas->capitalizar($suscriptor['direccion'] . " " . $suscriptor['referencia']);   $telefonos = $suscriptor['telefonos'];   $estado = empty($fila['realizado']) ? "rojo" : "verde";   $fila['estado'] = "<a href=\"#\" title=\"Estado\" onclick=\"parent.MUI.Distribucion_Instalacion('" . @$fila['instalacion'] . "');\"><img src=\"../../imagenes/16x16/" . ($estado) . ".png\" width=\"16\" height=\"16\"/>";   $fila['detalles'] = "&nbsp;" . $nombre . " " . $direccion . "" . $telefonos;   $fila['realizado'] = "&nbsp;" . $fila['realizado'] . "";   $fila['orden'] = "&nbsp;<b>" . $fila['orden'] . "</b>";   $fila['creador'] = "&nbsp;<a href=\"#\" onClick=\"parent.MUI.Notificacion('" . $creador['alias'] . "');\"><img src=\"../../imagenes/16x16/usuario-16x16.png\"></a>";   $suscriptor['conexion'] = ($suscriptor['conexion'] == "PARCIAL" ) ? "P" : "C";   echo("<tr>");   echo("<td align=\"center\">" . $fila['instalacion'] . "</td>");   echo("<td align=\"center\">" . $fila['suscriptor'] . "</td>");   echo("<td align=\"left\">" . $nombre . "</td>");   echo("<td align = \"left\">" . $direccion . "</td>");   echo("<td align = \"center\">" . $telefonos . "</td>");   echo("<td align=\"center\">" . $suscriptor['conexion'] . "</td>");   echo("<td align = \"left\">&nbsp;" . $suscriptor['diametro'] . "&nbsp;</td>");   echo("<td align = \"center\">&nbsp;" . $fila['fecha'] . "&nbsp;</td>");   echo("<td align = \"center\"></td>");   echo("</tr>");  }  $db->sql_close();  ?> </table></div><script type="text/javascript"> inicial =new Calendar({'fecha_inicial': 'Y-m-d'}, {classes: ['alternate'], navigation: 2, offset: 1}); final =new Calendar({'fecha_final': 'Y-m-d'}, {classes: ['alternate'], navigation: 2, offset: 1}); if ($('imprimir')) {  $('imprimir').addEvent('click', function(e) {   var bName = navigator.appName;   var bVer = parseFloat(navigator.appVersion);   var contenido_notificacion = document.getElementById("contenido_impresion").innerHTML;   ventana = window.open("modulos/alcantarilladoimprimir.php?", "ventana", "width=1000,height=480");   ventana.document.open();   ventana.document.write('<style>');   ventana.document.write('body{font-size:16px; text-align:lef;font-family:Tahoma,Arial, Helvetica, sans-serif}');   ventana.document.write('table{border:2px solid #000000;  border-collapse: collapse; border-spacing: 0;font-size: 12px;}');   ventana.document.write('</style>');   ventana.document.write(contenido_notificacion);   ventana.document.write('');   ventana.document.close();   ventana.print();   ventana.focus();  }); }</script><?php echo($formulario->cierre());?><?php  if (empty($accion)) { ?> <script type="text/javascript">  var fv =new Form.Validator.Inline($('<?php  echo($formulario->id); ?>'));  new Form.Request($('<?php  echo($formulario->id); ?>'), $('<?php  echo($formulario->interno); ?>'), {   requestOptions: {    spinnerOptions: {     message: 'Trasmitiendo datos...'    }   },   onSend: function() {    if ($('<?php  echo($formulario->interno ); ?>') && MUI.options.standardEffects == true) {     $('<?php  echo($formulario->interno ); ?>').setStyle('opacity', 1).get('morph').start({'opacity': 0});    }    $('spinner').show();   },   onSuccess: function() {    $('spinner').hide();    if ($('<?php  echo($formulario->interno ); ?>') && MUI.options.standardEffects == true) {     $('<?php  echo($formulario->interno ); ?>').setStyle('opacity', 0).get('morph').start({'opacity': 1});    }    //MUI.closeWindow($('<?php  echo($formulario->ventana); ?>'));   }  }); </script><?php  } ?>